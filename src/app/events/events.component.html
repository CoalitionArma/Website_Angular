<div class="events-container">
  <div class="content-wrapper">
    <div class="header">
      <h1>Events</h1>
      <button 
        mat-raised-button 
        color="primary" 
        (click)="openCreateEventDialog()"
        [disabled]="!isLoggedIn || !isAdmin">
        <mat-icon>add</mat-icon>
        Create Event
      </button>
    </div>

    <div *ngIf="!isLoggedIn" class="login-notice">
      <mat-icon>info_outline</mat-icon>
      <span>Log in to create events and slot into roles</span>
    </div>

    <div *ngIf="isLoggedIn && !isAdmin" class="login-notice">
      <mat-icon>admin_panel_settings</mat-icon>
      <span>Only administrators can create events</span>
    </div>

    <div *ngIf="isLoading" class="loading-container">
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
      <p>Loading events...</p>
    </div>

    <div *ngIf="!isLoading && events.length === 0" class="no-events">
      <mat-icon>event_note</mat-icon>
      <h2>No Events Planned</h2>
      <p>Check in on discord for news</p>
    </div>

    <div class="events-list" *ngIf="!isLoading && events.length > 0">
      <!-- Pagination Controls -->
      <div class="pagination-controls" *ngIf="events.length > 1">
        <button 
          mat-icon-button 
          [disabled]="!hasPreviousPage"
          (click)="previousPage()"
          class="pagination-button">
          <mat-icon>chevron_left</mat-icon>
        </button>
        
        <span class="pagination-info">
          Event {{ currentPage + 1 }} of {{ totalPages }}
        </span>
        
        <button 
          mat-icon-button 
          [disabled]="!hasNextPage"
          (click)="nextPage()"
          class="pagination-button">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>

      <!-- Current Event Display -->
      <mat-card *ngIf="currentEvent" 
                class="event-card" 
                [class.selected]="isEventSelected(currentEvent)"
                (click)="selectEvent(currentEvent)">
        <!-- Event Header -->
        <mat-card-header>
          <mat-card-title class="event-title">
            {{ currentEvent.title }}
            <span class="event-actions" *ngIf="canDeleteEvent(currentEvent)">
              <button mat-icon-button 
                      color="warn" 
                      (click)="deleteEvent(currentEvent.id); $event.stopPropagation()" 
                      title="Delete Event">
                <mat-icon>delete</mat-icon>
              </button>
            </span>
          </mat-card-title>
          <mat-card-subtitle>
            <div class="event-meta">
              <span class="event-date">
                <mat-icon>schedule</mat-icon>
                {{ formatDateTime(currentEvent.dateTime) }}
              </span>
              <span class="event-creator">
                <mat-icon>person_outline</mat-icon>
                Created by {{ currentEvent.createdByUsername }}
              </span>
            </div>
          </mat-card-subtitle>
        </mat-card-header>

        <!-- Event Banner -->
        <div *ngIf="currentEvent.bannerUrl" class="event-banner">
          <img [src]="currentEvent.bannerUrl" [alt]="currentEvent.title + ' banner'" />
        </div>

        <!-- Event Description -->
        <mat-card-content>
          <p *ngIf="currentEvent.description" class="event-description" style="margin-top: 16px;">{{ currentEvent.description }}</p>

          <!-- Click to expand hint -->
          <div *ngIf="!isEventSelected(currentEvent)" class="expand-hint">
            <mat-icon>expand_more</mat-icon>
            <span>Click to view roster and slot into roles</span>
          </div>

          <!-- Groups and Roles - Only show when selected -->
          <div *ngIf="isEventSelected(currentEvent)" class="roster-section">
            <h3>Event Roster</h3>
            
            <!-- Slot Lock Warning -->
            <div *ngIf="areSlotsLocked(currentEvent)" class="slot-lock-warning">
              <mat-icon>lock</mat-icon>
              <span>{{ getSlotLockMessage(currentEvent) }}</span>
            </div>
            
            <!-- Sides-based Layout -->
            <div class="sides-container">
              <div *ngFor="let side of currentEvent.sides" class="side-column">
                <div class="side-header" [style.border-left-color]="side.color">
                  <h4 class="side-name">{{ side.name }}</h4>
                </div>
                
                <div *ngFor="let group of side.groups" 
                     class="group-section"
                     [id]="'group-' + group.id"
                     [class.highlighted]="highlightedGroupId === group.id">
                  <div class="group-name-container">
                    <h4 class="group-name">{{ group.name }}
                      <button 
                        mat-icon-button
                        class="copy-group-link-button"
                        (click)="copyGroupLink(group.id); $event.stopPropagation()">
                        <mat-icon>link</mat-icon>
                      </button>
                    </h4>
                  </div>
                  
                  <div class="roles-list">
                    <div 
                      *ngFor="let role of group.roles" 
                      class="role-item"
                      [id]="'role-' + role.id"
                      [class.highlighted]="highlightedRoleId === role.id">
                      <div class="role-info">
                        <div class="role-name-container">
                          <span class="role-name">{{ role.name }}
                            <button 
                              mat-icon-button
                              class="copy-link-button"
                              (click)="copyRoleLink(role.id); $event.stopPropagation()">
                              <mat-icon>link</mat-icon>
                            </button>
                          </span>
                        </div>
                        <span class="role-status" [class.slotted]="role.slottedUser">
                          {{ role.slottedUser || 'OPEN' }}
                        </span>
                      </div>
                      
                      <!-- Role actions only for future events -->
                      <div class="role-actions" *ngIf="isLoggedIn">
                        <!-- Admin kick button - only show for admins when role is slotted by someone else -->
                        <button 
                          *ngIf="isAdmin && role.slottedUserId && !isUserSlottedInRole(currentEvent, side.id, group.id, role.id)" 
                          mat-icon-button 
                          color="warn" 
                          (click)="kickUserFromRole(currentEvent.id, side.id, group.id, role.id); $event.stopPropagation()"
                          class="kick-button"
                          title="Kick {{ role.slottedUser }} from this role">
                          <mat-icon>person_remove</mat-icon>
                        </button>

                        <button 
                          *ngIf="!isUserSlottedInRole(currentEvent, side.id, group.id, role.id)" 
                          mat-raised-button 
                          color="primary" 
                          (click)="slotRole(currentEvent.id, side.id, group.id, role.id); $event.stopPropagation()"
                          [disabled]="!canSlotRole(currentEvent, side.id, group.id, role.id)"
                          class="slot-button">
                          Slot
                        </button>
                        
                        <button 
                          *ngIf="isUserSlottedInRole(currentEvent, side.id, group.id, role.id)" 
                          mat-raised-button 
                          color="warn" 
                          (click)="unslotRole(currentEvent.id, side.id, group.id, role.id); $event.stopPropagation()"
                          class="unslot-button">
                          Unslot
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
